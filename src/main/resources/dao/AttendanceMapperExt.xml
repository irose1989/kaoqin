<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.isoftstone.kaoqin.dao.attendanceMapper.AttendanceMapperExt" >
  <resultMap id="BaseResultMap" type="com.isoftstone.kaoqin.controller.vo.AttendanceVo2" >
    <result column="real_name" property="realName" jdbcType="VARCHAR"/>
    <result column="project_name" property="projectName" jdbcType="VARCHAR"/>
    <collection property="attendanceList" ofType="com.isoftstone.kaoqin.bean.attendance.Attendance" resultMap="attend"/>
  </resultMap>
  <resultMap id="attend" type="com.isoftstone.kaoqin.bean.attendance.Attendance">
    <id column="attend_id" property="id" jdbcType="BIGINT" />
    <result column="date" property="date" jdbcType="DATE" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="workhours" property="workhours" jdbcType="INTEGER" />
    <result column="overhour" property="overhour" jdbcType="DOUBLE" />
    <result column="work_off" property="workOff" jdbcType="INTEGER" />
    <result column="late" property="late" jdbcType="INTEGER" />
    <result column="early" property="early" jdbcType="INTEGER" />
    <result column="absent" property="absent" jdbcType="INTEGER" />
    <result column="on_duty" property="onDuty" jdbcType="TIMESTAMP" />
    <result column="off_duty" property="offDuty" jdbcType="TIMESTAMP" />
    <result column="description" property="description" jdbcType="VARCHAR" />
  </resultMap>

  <select id="select" resultMap="BaseResultMap"  parameterType="Map" >
   select a.real_name,c.project_name,b.date from attendance b , emp_user a ,project c WHERE
   a.project_id = c.project_id and a.user_id = b.user_id
    and b.date >= #{from} and #{to} >=b.date
  <if test="projectId !=null">
      AND c.id = #{projectId}
  </if>
  <if test="userId !=null">
    AND a.id = #{userId}
  </if>
  GROUP BY b.user_id,b.date
  ORDER by c.project_id
  <if test="limit > -1">
    limit #{limit},#{size};
  </if>
  </select>

  <!--<select id="attend" resultMap="attend" >
    select * from attendance b
    WHERE b.date >= #{from} and #{to} >=b.date
    GROUP BY b.user_id,b.date
  </select>-->

</mapper>